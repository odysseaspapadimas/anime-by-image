{"version":3,"sources":["img/mal.png","fetchAnime.js","ImageUpload.js","fetchAnimeMAL.js","App.js","index.js"],"names":["module","exports","fetchAnime","canvas","a","fetch","method","body","JSON","stringify","image","toDataURL","headers","then","res","json","result","console","log","ImageUpload","props","ctx","useState","picture","setPicture","anime","setAnime","video","setVideo","muted","setMuted","fetching","setFetching","useEffect","anilist_id","filename","at","tokenthumb","undefined","videoSrc","encodeURIComponent","vid","document","querySelector","style","display","vidPromise","play","catch","error","imgSrc","handleClick","animeFetched","docs","title_romaji","episode","similarity","from","mal_id","onFetch","handleMute","handleRestart","currentTime","className","ref","src","icon","faVolumeMute","onClick","faVolumeUp","faHistory","alt","singleImage","withLabel","withIcon","buttonText","onChange","upload","URL","createObjectURL","timer","setInterval","img","preview","width","naturalWidth","height","naturalHeight","getContext","drawImage","clearInterval","fetchAnimeMAL","App","info","setInfo","malInfo","setMalInfo","link","setLink","fetched","setFetched","time","setTime","didMountRef","current","getMalInfo","seconds","Math","floor","minutes","secs","useRef","url","role","aria-label","val","href","target","rel","mal","ReactDOM","render","getElementById"],"mappings":"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","file":"static/js/main.936ce090.chunk.js","sourcesContent":["module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAMAAACdt4HsAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAEdUExURS5RomF8ufz9/q272lRxs/f4+////8vT6Dlbp32TxbjE3+Hm8vr7/e7x9zFTo2V/ul55uGJ8uXSLwTtbqDVXpZeo0fT2+mV+uvL0+UdmrS9Sor7J4kZlrdfe7am42c7W6ZCizTtcqODl8e7w98zV6LnF4GN+uqy62pip0TJUpKCw1cjR5snS58rT58vU6FVys/Dy+ERjrPz8/rXB3oaayU9ssIuey66828zU6LG+3GR+uneOwjJVpN/k8TxdqMfR5u/y+Etpr8HL4z5eqVx3tqi32Ozv9uXp84SZyPb3+zBTo1Vxs1p2tq+821t2tpus0155t6u52ejs9X6TxcDL4/v8/Yqey1l1tWeBvDxcqEporomdyt3j8Dhap5ys0x9BpC4AAAAJcEhZcwAADsMAAA7DAcdvqGQAAAFiSURBVFhH7ZNnU8JAEIbXqGeJolGCGgtGsVDE3hWsWGJv2P//z3B375wQyQw3ftKZez5k3y3zwJABDAaDwfAHabKQZplbWoUQbTJDe0en3YW96E4A9FDoVZsoDq1EH8V+m6IUJN0UL4gBDcHgEIA3zJEFI6OcJWMaApFOwLhMJPAnOE6mM8SUjkC405YMJJjhNJuFXL4wV5zXElgLKqBgcYnCMm6LFJzGAv61VUXBCjeruNUVrNH7E2J9Ax8o2KTGziIZShqCrW16FnaUIE9diI4AckLslkAJ+HNDtASJ8t4+fAsOaBaiJYDDI2yU4BhLxSVOaKsnYJTgFMvZOQ1038IPQUCzCxpEBJf8pa74MiRO4FWwXtMgIpDc8GVInABusd5lMdQLUjSuJVbAw3sM9YIHPqzBdxBfNQHmAKuH/8bHJwzVZ6QE8EJXzCsfNuRNvFdV/B0fn0mVDAaDwfAPAPgCTM8rgym6oj8AAAAASUVORK5CYII=\"","export const fetchAnime = async (canvas) => {\r\n  return await fetch(\"https://trace.moe/api/search\", {\r\n    method: \"POST\",\r\n    body: JSON.stringify({ image: canvas.toDataURL(\"image/jpeg\", 0.8) }),\r\n    headers: { \"Content-Type\": \"application/json\" },\r\n  })\r\n    .then((res) => res.json())\r\n    .then((result) => {\r\n      console.log(result);\r\n      return result;\r\n    });\r\n};\r\n","import React, { useState, useEffect } from \"react\";\r\nimport ImageUploader from \"react-images-upload\";\r\nimport { fetchAnime } from \"./fetchAnime\";\r\n\r\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\r\nimport {\r\n  faVolumeMute,\r\n  faVolumeUp,\r\n  faHistory,\r\n} from \"@fortawesome/free-solid-svg-icons\";\r\n\r\nfunction ImageUpload(props) {\r\n  const [picture, setPicture] = useState(null);\r\n  //eslint-disable-next-line\r\n  const [anime, setAnime] = useState({});\r\n  const [video, setVideo] = useState();\r\n  const [muted, setMuted] = useState(true);\r\n  const [fetching, setFetching] = useState(false);\r\n\r\n  var ctx;\r\n  let canvas;\r\n  const onDrop = (upload) => {\r\n    setPicture(URL.createObjectURL(upload[0]));\r\n\r\n    const timer = setInterval(() => {\r\n      const img = document.querySelector(\".image\");\r\n      const preview = document.querySelector(\".preview\");\r\n      preview.width = img.naturalWidth;\r\n      preview.height = img.naturalHeight;\r\n\r\n      canvas = document.querySelector(\"canvas\");\r\n      canvas.width = img.naturalWidth;\r\n      canvas.height = img.naturalHeight;\r\n      ctx = canvas.getContext(\"2d\");\r\n      ctx.drawImage(img, 0, 0, canvas.width, canvas.height);\r\n\r\n      clearInterval(timer);\r\n    }, 50);\r\n  };\r\n  useEffect(() => {\r\n    const { anilist_id, filename, at, tokenthumb } = anime;\r\n\r\n    if (anilist_id !== undefined) {\r\n      const videoSrc = `https://media.trace.moe/video/${anilist_id}/${encodeURIComponent(\r\n        filename\r\n      )}?t=${at}&token=${tokenthumb}`;\r\n      setVideo(videoSrc);\r\n      const vid = document.querySelector(\"video\");\r\n      const vidContainer = document.querySelector(\".video-container\");\r\n      vidContainer.style.display = \"block\";\r\n      const canvas = document.querySelector(\"canvas\");\r\n      canvas.style.display = \"none\";\r\n      // eslint-disable-next-line\r\n      const muteBtn = (document.querySelector(\".mute-btn\").style.display =\r\n        \"block\");\r\n      // eslint-disable-next-line\r\n      const restartBtn = (document.querySelector(\".restart-btn\").style.display =\r\n        \"block\");\r\n      vid.muted = true;\r\n\r\n      const vidPromise = vid.play();\r\n\r\n      if (vidPromise !== undefined) {\r\n        vidPromise.then(() => {}).catch((error) => {});\r\n      }\r\n    }\r\n  }, [video, anime]);\r\n\r\n  useEffect(() => {\r\n    const { anilist_id, filename, at, tokenthumb } = anime;\r\n\r\n    if (anilist_id !== undefined) {\r\n      const imgSrc = `https://trace.moe/thumbnail.php?anilist_id=${anilist_id}&file=${encodeURIComponent(\r\n        filename\r\n      )}&t=${at}&token=${tokenthumb}`;\r\n      setPicture(imgSrc);\r\n    }\r\n  }, [picture, anime]);\r\n\r\n  const handleClick = async () => {\r\n    setFetching(true);\r\n    canvas = document.querySelector(\"canvas\");\r\n    const animeFetched = await fetchAnime(canvas);\r\n    setFetching(false);\r\n    const {\r\n      title_romaji,\r\n      episode,\r\n      anilist_id,\r\n      filename,\r\n      similarity,\r\n      at,\r\n      from,\r\n      tokenthumb,\r\n      mal_id,\r\n    } = animeFetched.docs[0];\r\n    console.log(animeFetched.docs[0]);\r\n    setAnime({\r\n      title_romaji,\r\n      anilist_id,\r\n      at,\r\n      filename,\r\n      similarity,\r\n      tokenthumb,\r\n      mal_id,\r\n    });\r\n\r\n    props.onFetch({\r\n      title_romaji,\r\n      episode,\r\n      anilist_id,\r\n      at,\r\n      from,\r\n      filename,\r\n      similarity,\r\n      tokenthumb,\r\n      mal_id,\r\n    });\r\n\r\n    setPicture();\r\n  };\r\n\r\n  const handleMute = () => {\r\n    const vid = document.querySelector(\"video\");\r\n    if (muted) {\r\n      vid.muted = false;\r\n      setMuted(false);\r\n    } else {\r\n      vid.muted = true;\r\n      setMuted(true);\r\n    }\r\n  };\r\n\r\n  const handleRestart = () => {\r\n    const vid = document.querySelector(\"video\");\r\n    vid.currentTime = 0;\r\n    vid.play();\r\n  };\r\n  return (\r\n    <div className=\"upload-container\">\r\n      <div className=\"preview\" style={{}}>\r\n        <canvas ref={ctx}></canvas>\r\n\r\n        <div className=\"video-container\">\r\n          <video src={`${video}`}></video>\r\n          {muted ? (\r\n            <FontAwesomeIcon\r\n              icon={faVolumeMute}\r\n              onClick={handleMute}\r\n              className=\"mute-btn\"\r\n            />\r\n          ) : (\r\n            <FontAwesomeIcon\r\n              icon={faVolumeUp}\r\n              onClick={handleMute}\r\n              className=\"mute-btn\"\r\n            />\r\n          )}\r\n\r\n          <FontAwesomeIcon\r\n            icon={faHistory}\r\n            onClick={handleRestart}\r\n            className=\"restart-btn\"\r\n          />\r\n\r\n          <button onClick={handleRestart} className=\"restart-btn\">\r\n            Restart\r\n          </button>\r\n        </div>\r\n      </div>\r\n      <br />\r\n      <img\r\n        className=\"image\"\r\n        src={`${picture}`}\r\n        alt=\"\"\r\n        style={{ display: \"none\" }}\r\n      />\r\n\r\n      <ImageUploader\r\n        singleImage={true}\r\n        withLabel={false}\r\n        withIcon={false}\r\n        buttonText=\"Upload image\"\r\n        onChange={onDrop}\r\n      />\r\n      <button className=\"search\" onClick={handleClick}>\r\n        {!fetching ? (\r\n          \"Search\"\r\n        ) : (\r\n          <div className=\"lds-default\">\r\n            <div></div>\r\n            <div></div>\r\n            <div></div>\r\n            <div></div>\r\n            <div></div>\r\n            <div></div>\r\n            <div></div>\r\n            <div></div>\r\n            <div></div>\r\n            <div></div>\r\n            <div></div>\r\n            <div></div>\r\n          </div>\r\n        )}\r\n      </button>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default ImageUpload;\r\n","export const fetchAnimeMAL = async (mal_id) => {\r\n  console.log(mal_id);\r\n  if (mal_id !== undefined) {\r\n    console.log('hoo');\r\n    return await fetch(`https://api.jikan.moe/v3/anime/${mal_id}`) // jikan api with MAL ID https://jikan.docs.apiary.io/#introduction\r\n      .then((res) => res.json())\r\n      .then((result) => {\r\n        console.log(result);\r\n        return result;\r\n      });\r\n  }\r\n};\r\n","import React, { useState, useEffect, useRef } from \"react\";\nimport \"./App.css\";\nimport ImageUpload from \"./ImageUpload\";\nimport { fetchAnimeMAL } from \"./fetchAnimeMAL\";\nimport mal from \"./img/mal.png\";\n\nfunction App() {\n  const [info, setInfo] = useState({});\n  const [malInfo, setMalInfo] = useState({});\n  const [link, setLink] = useState(\"\");\n  const [fetched, setFetched] = useState(false);\n  const [time, setTime] = useState(\"\");\n\n  const onFetch = (val) => {\n    setInfo(val);\n  };\n\n  useEffect(() => {\n    async function getMalInfo() {\n      let res = await fetchAnimeMAL(info.mal_id);\n      setMalInfo(res);\n    }\n\n    if (didMountRef.current) {\n      getMalInfo();\n      setFetched(true);\n    } else {\n      didMountRef.current = true;\n    }\n\n    const seconds = Math.floor(info.from) - 7; //\n    const minutes = Math.floor(seconds / 60);\n    let secs = seconds % 60;\n    if (secs < 10) secs = `0${secs}`;\n    setTime(`${minutes}:${secs}`);\n  }, [info]);\n\n  const didMountRef = useRef(false);\n  useEffect(() => {\n    console.log(didMountRef.current, 'ηι');\n  });\n\n  useEffect(() => {\n    if (malInfo) setLink(malInfo.url);\n  }, [malInfo]);\n\n  return (\n    <div className=\"App\">\n      <h1>\n        Upload an image to find the sauce{\" \"}\n        <span role=\"img\" aria-label=\"sauce\">\n          🥫\n        </span>{\" \"}\n      </h1>\n      <ImageUpload onFetch={onFetch} />\n      <p className=\"result\">\n        {fetched &&\n          `Anime: ${info.title_romaji} - Episode: ${info.episode} - Timestamp: ${time}`}\n      </p>\n\n      {fetched && (\n        <a href={link} target=\"_blank\" rel=\"noopener noreferrer\">\n          <img src={mal} alt=\"\" />\n        </a>\n      )}\n    </div>\n  );\n}\n\nexport default App;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport App from \"./App\";\n\nReactDOM.render(<App />, document.getElementById(\"root\"));\n"],"sourceRoot":""}